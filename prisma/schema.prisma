generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                String                 @id @default(auto()) @map("_id") @db.ObjectId
  email             String                 @unique
  password          String
  name              String                 @unique
  bio               String?
  profilePicture    String                 @default("/pokeball.png")
  score             Int                    @default(0)
  pokeMoney         Int                    @default(0)
  pokemons          Pokemon[]
  resetTokens       PasswordResetToken[]
  lastPokedleWin    DateTime?
  dailyQuizSessions Int                    @default(0)
  lastQuizPlayed    DateTime?
  claimedRewards    ClaimedReward[]
  quizSessions      QuizSession[] 
  
}

model ClaimedReward {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  level     Int
  createdAt DateTime @default(now())

  @@unique([userId, level])
  @@index([userId])
}

model Pokemon {
  id                  String  @id @default(auto()) @map("_id") @db.ObjectId
  userId              String  @db.ObjectId
  user                User    @relation(fields: [userId], references: [id])
  name                String
  names               Json
  isShiny             Boolean @default(false)
  nationalId          Int
  generation          Int
  type1               String
  type2               String?
  hp                  Int
  attack              Int
  defense             Int
  spAttack            Int
  spDefense           Int
  speed               Int
  spriteDefault       String?
  spriteShiny         String?
  spriteBack          String?
  spriteBackShiny     String?
  spriteHome          String?
  spriteDream         String?
  spriteOfficial      String?
  spriteShowdown      String?
  spriteShowdownShiny String?

  @@index([userId])
}

model PasswordResetToken {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  token     String   @unique
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model QuizSession {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  userId            String    @db.ObjectId
  user              User      @relation(fields: [userId], references: [id])
  type              String
  questions         Json
  answers           Json?
  status            String    @default("pending")
  isRewardEligible  Boolean   @default(false)
  scoreGained       Int       @default(0)
  pokeMoneyGained   Int       @default(0)
  pokemonCapturedId String?
  createdAt         DateTime  @default(now())

  @@index([userId])
}